CREATE TABLE PATIENTS_AUD (
	EVENT_ID INT(11) NOT NULL AUTO_INCREMENT,
    EVENT_DATE DATETIME NOT NULL,
    EVENT_TYPE VARCHAR(10) DEFAULT NULL,
    PATIENT_ID INT(11) NOT NULL,
    OLD_FIRSTNAME VARCHAR(255),
    NEW_FIRSTNAME VARCHAR(255),
    OLD_LASTNAME VARCHAR(255),
    NEW_LASTNAME VARCHAR(255),
    OLD_PIN VARCHAR(255),
    NEW_PIN VARCHAR(255),
    OLD_PHONE_NUMBER VARCHAR(255),
    NEW_PHONE_NUMBER VARCHAR(255),
    OLD_EMAIL VARCHAR(255),
    NEW_EMAIL VARCHAR(255),
    PRIMARY KEY (`EVENT_ID`)
);

DELIMITER $$

CREATE TRIGGER PATIENTS_INSERT AFTER INSERT ON PATIENTS
FOR EACH ROW
BEGIN
    INSERT INTO PATIENTS_AUD (EVENT_DATE, EVENT_TYPE, PATIENT_ID, NEW_FIRSTNAME, NEW_LASTNAME, NEW_PIN, NEW_PHONE_NUMBER, NEW_EMAIL)
        VALUES (CURTIME(), "INSERT", PATIENT_ID, NEW.FIRSTNAME, NEW.LASTNAME, NEW.PIN, NEW.PHONE_NUMBER, NEW.EMAIL);
END $$

DELIMITER ;

DELIMITER $$

CREATE TRIGGER PATIENTS_DELETE AFTER DELETE ON PATIENTS
FOR EACH ROW
BEGIN
    INSERT INTO PATIENTS_AUD (EVENT_DATE, EVENT_TYPE, PATIENT_ID)
        VALUES (CURTIME(), "DELETE", PATIENT_ID);
END $$

DELIMITER ;

DELIMITER $$

CREATE TRIGGER PATIENTS_UPDATE AFTER UPDATE ON PATIENTS
FOR EACH ROW
BEGIN
    INSERT INTO PATIENTS_AUD (EVENT_DATE, EVENT_TYPE, PATIENT_ID, NEW_FIRSTNAME, NEW_LASTNAME, NEW_PIN, NEW_PHONE_NUMBER, NEW_EMAIL, OLD_FIRSTNAME, OLD_LASTNAME, OLD_PIN, OLD_PHONE_NUMBER, OLD_EMAIL)
        VALUES (CURTIME(), "UPDATE", PATIENT_ID, NEW.FIRSTNAME, NEW.LASTNAME, NEW.PIN, NEW.PHONE_NUMBER, NEW.EMAIL, OLD.FIRSTNAME, OLD.LASTNAME, OLD.PIN, OLD.PHONE_NUMBER, OLD.EMAIL);
END $$

DELIMITER ;
