CREATE TABLE APPOINTMENTS_AUD (
	EVENT_ID INT(11) NOT NULL AUTO_INCREMENT,
    EVENT_DATE DATETIME NOT NULL,
    EVENT_TYPE VARCHAR(10) DEFAULT NULL,
    APPOINTMENT_ID INT(11) NOT NULL,
    OLD_DOCTOR_ID INT(11),
    NEW_DOCTOR_ID INT(11),
    OLD_PATIENT_ID INT(11),
    NEW_PATIENT_ID INT(11),
    OLD_VISIT_DATE DATETIME,
    NEW_VISIT_DATE DATETIME,
    PRIMARY KEY (`EVENT_ID`)
);

DELIMITER $$

CREATE TRIGGER APPOINTMENT_INSERT AFTER INSERT ON APPOINTMENTS
FOR EACH ROW
BEGIN
    INSERT INTO APPOINTMENTS_AUD (EVENT_DATE, EVENT_TYPE, APPOINTMENT_ID, NEW_DOCTOR_ID, NEW_PATIENT_ID, NEW_VISIT_DATE)
        VALUES (CURTIME(), "INSERT", APPOINTMENT_ID, NEW.DOCTOR_ID, NEW.PATIENT_ID, NEW.VISIT_DATE);
END $$

DELIMITER ;

DELIMITER $$

CREATE TRIGGER APPOINTMENTS_DELETE AFTER DELETE ON APPOINTMENTS
FOR EACH ROW
BEGIN
    INSERT INTO APPOINTMENTS_AUD (EVENT_DATE, EVENT_TYPE, APPOINTMENT_ID)
        VALUES (CURTIME(), "DELETE", APPOINTMENT_ID);
END $$

DELIMITER ;

DELIMITER $$

CREATE TRIGGER APPOINTMENT_UPDATE AFTER UPDATE ON APPOINTMENT
FOR EACH ROW
BEGIN
    INSERT INTO APPOINTMENTS_AUD (EVENT_DATE, EVENT_TYPE, APPOINTMENT_ID, NEW_DOCTOR_ID, NEW_PATIENT_ID, NEW_VISIT_DATE, OLD_DOCTOR_ID, OLD_PATIENT_ID, OLD_VISIT_DATE)
        VALUES (CURTIME(), "UPDATE", APPOINTMENT_ID, NEW.DOCTOR_ID, NEW.PATIENT_ID, NEW.VISIT_DATE, OLD.DOCTOR_ID, OLD.PATIENT_ID, OLD.VISIT_DATE);
END $$

DELIMITER ;
